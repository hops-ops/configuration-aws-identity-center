apiVersion: apiextensions.crossplane.io/v2
kind: CompositeResourceDefinition
metadata:
  name: identitycenters.aws.hops.ops.com.ai
spec:
  scope: Namespaced
  group: aws.hops.ops.com.ai
  names:
    kind: IdentityCenter
    plural: identitycenters
  versions:
  - name: v1alpha1
    served: true
    referenceable: true
    schema:
      openAPIV3Schema:
        type: object
        description: IdentityCenter provisions AWS Identity Center instances, local users, permission sets, and account assignments.
        required:
        - spec
        properties:
          spec:
            type: object
            description: Desired Identity Center configuration.
            required:
            - managementPolicies
            - identityStoreId
            - region
            properties:
              organizationName:
                type: string
                description: Logical name used for tagging and naming rendered resources. Defaults to metadata.name.
              region:
                type: string
                description: AWS region for Identity Center and Identity Store resources.
              managementPolicies:
                type: array
                description: Management operations allowed on composed resources. Use ["*"] for full management or omit Delete to orphan.
                items:
                  type: string
                  enum:
                  - "*"
                  - Create
                  - Observe
                  - Update
                  - Delete
                  - LateInitialize
                default:
                - "*"
              imports:
                type: object
                description: |
                  External names of existing AWS resources to import into Crossplane management.
                  Use with managementPolicies excluding "Delete" to adopt without risk of deletion.
                  Leave fields empty to create new resources.
                properties:
                  users:
                    type: object
                    description: |
                      Map of user display names to Identity Store User IDs.
                      Example: { "john.doe": "84815e08-..." }
                    additionalProperties:
                      type: string
                  groups:
                    type: object
                    description: |
                      Map of group names to Identity Store Group IDs.
                      Example: { "Admins": "94815e08-..." }
                    additionalProperties:
                      type: string
                  groupMemberships:
                    type: object
                    description: |
                      Map of "username/groupName" to Identity Store Group Membership IDs.
                      Example: { "john.doe/Admins": "115b85b0-..." }
                    additionalProperties:
                      type: string
                  permissionSets:
                    type: object
                    description: |
                      Map of permission set names to external name format.
                      Format: "PERMISSION_SET_ARN,INSTANCE_ARN"
                      Example: { "AdminAccess": "arn:aws:sso:::permissionSet/.../ps-...,arn:aws:sso:::instance/..." }
                    additionalProperties:
                      type: string
              providerConfigRef:
                type: object
                description: Reference to the ProviderConfig used for all AWS API calls.
                properties:
                  name:
                    type: string
                    description: Name of the ProviderConfig. Defaults to metadata.name.
                  kind:
                    type: string
                    description: Kind of the provider config reference. Defaults to ProviderConfig.
                    default: ProviderConfig
              labels:
                type: object
                description: Custom labels applied to all managed resources. Merged with default labels (hops.ops.com.ai/managed, hops.ops.com.ai/<kind>).
                additionalProperties:
                  type: string
                x-kubernetes-preserve-unknown-fields: true
              identityStoreId:
                type: string
                description: Identity Store ID (for example, d-1234567890).
              identityCenter:
                type: object
                description: Optional overrides for the Identity Center instance.
                properties:
                  instanceArn:
                    type: string
                    description: Identity Center instance ARN (arn:aws:sso:::instance/ssoins-1234567890abcdef). If not provided, the composition will create a new instance.
                  relayState:
                    type: string
                    description: Default relay state for permission sets.
                  sessionDuration:
                    type: string
                    description: Default session duration (ISO8601). Defaults to PT1H.
                  tags:
                    type: object
                    description: Extra tags merged onto permission sets.
                    x-kubernetes-preserve-unknown-fields: true
              groups:
                type: array
                description: Optional list of Identity Store groups to create.
                items:
                  type: object
                  required:
                  - name
                  properties:
                    name:
                      type: string
                      description: Logical group name.
                    displayName:
                      type: string
                    description:
                      type: string
                    managementPolicies:
                      type: array
                      description: |
                        ManagementPolicies for this group. Overrides spec.managementPolicies if set.
                        Use to orphan specific groups on deletion while deleting others.
                      items:
                        type: string
                        enum:
                        - "*"
                        - Create
                        - Observe
                        - Update
                        - Delete
                        - LateInitialize
                    tags:
                      type: object
                      description: Extra labels mirrored onto the metadata.labels map.
                      x-kubernetes-preserve-unknown-fields: true
                    forProvider:
                      type: object
                      description: Override any forProvider field on the rendered Group resource. Keys here overwrite template defaults. See provider docs.
                      x-kubernetes-preserve-unknown-fields: true
              users:
                type: array
                description: Optional list of users to create in the Identity Store.
                items:
                  type: object
                  required:
                  - email
                  - username
                  properties:
                    username:
                      type: string
                      description: Identity Store username.
                    email:
                      type: string
                    firstName:
                      type: string
                    lastName:
                      type: string
                    displayName:
                      type: string
                    managementPolicies:
                      type: array
                      description: |
                        ManagementPolicies for this user. Overrides spec.managementPolicies if set.
                        Use to orphan specific users on deletion while deleting others.
                      items:
                        type: string
                        enum:
                        - "*"
                        - Create
                        - Observe
                        - Update
                        - Delete
                        - LateInitialize
                    groups:
                      type: array
                      description: Group names the user should join.
                      items:
                        type: string
                    tags:
                      type: object
                      description: Extra labels mirrored onto the metadata.labels map.
                      x-kubernetes-preserve-unknown-fields: true
                    forProvider:
                      type: object
                      description: Override any forProvider field on the rendered User resource. Keys here overwrite template defaults. See provider docs.
                      x-kubernetes-preserve-unknown-fields: true
              permissionSets:
                type: array
                description: Optional permission sets plus account assignments.
                items:
                  type: object
                  required:
                  - name
                  properties:
                    name:
                      type: string
                      description: Name of the permission set presented in the AWS console.
                    description:
                      type: string
                    relayState:
                      type: string
                    sessionDuration:
                      type: string
                    managementPolicies:
                      type: array
                      description: |
                        ManagementPolicies for this permission set. Overrides spec.managementPolicies if set.
                        Use to orphan specific permission sets on deletion while deleting others.
                      items:
                        type: string
                        enum:
                        - "*"
                        - Create
                        - Observe
                        - Update
                        - Delete
                        - LateInitialize
                    inlinePolicy:
                      type: string
                      description: Inline JSON policy document attached to the permission set.
                    managedPolicies:
                      type: array
                      description: AWS managed policy ARNs to attach.
                      items:
                        type: string
                    customerManagedPolicies:
                      type: array
                      description: Customer managed policy references to attach.
                      items:
                        type: object
                        required:
                        - name
                        properties:
                          name:
                            type: string
                            description: Name of the IAM policy.
                          path:
                            type: string
                            description: Path containing the IAM policy. Defaults to /.
                    tags:
                      type: object
                      x-kubernetes-preserve-unknown-fields: true
                    forProvider:
                      type: object
                      description: Override any forProvider field on the rendered PermissionSet resource. Keys here overwrite template defaults. See provider docs.
                      x-kubernetes-preserve-unknown-fields: true
                    assignToAccounts:
                      type: array
                      description: AWS account identifiers that should receive assignments.
                      items:
                        type: string
                    assignToGroups:
                      type: array
                      description: Identity Store group names that should receive assignments.
                      items:
                        type: string
                    assignToUsers:
                      type: array
                      description: Local user names that should receive assignments.
                      items:
                        type: string
                    assignments:
                      type: array
                      description: Advanced account assignments applied to this permission set.
                      items:
                        type: object
                        required:
                        - accountId
                        properties:
                          accountId:
                            type: string
                          principal:
                            type: object
                            description: Preferred way to reference principals.
                            properties:
                              type:
                                type: string
                                enum:
                                - USER
                                - GROUP
                              id:
                                type: string
                              name:
                                type: string
                          principalType:
                            type: string
                            description: Deprecated; prefer principal.type.
                          principalId:
                            type: string
                            description: Deprecated; prefer principal.id.
              externalIdP:
                type: object
                description: Optional external identity provider integration.
                properties:
                  type:
                    type: string
                    enum:
                    - oidc
                    - saml
                  issuerUrl:
                    type: string
                  clientIdSecretRef:
                    type: object
                    properties:
                      name:
                        type: string
                      namespace:
                        type: string
                      key:
                        type: string
                  clientSecretSecretRef:
                    type: object
                    properties:
                      name:
                        type: string
                      namespace:
                        type: string
                      key:
                        type: string
          status:
            type: object
            description: Observed state for IdentityCenter.
            properties:
              organizationName:
                type: string
              identityCenter:
                type: object
                properties:
                  instanceArn:
                    type: string
                  ready:
                    type: boolean
              identityStore:
                type: object
                properties:
                  id:
                    type: string
                  users:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        id:
                          type: string
                          nullable: true
                  groups:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        id:
                          type: string
                          nullable: true
              permissionSets:
                type: array
                items:
                  type: object
                  properties:
                    name:
                      type: string
                    arn:
                      type: string
                      nullable: true
                    assignments:
                      type: array
                      items:
                        type: object
                        properties:
                          accountId:
                            type: string
                          principalType:
                            type: string
                          principalId:
                            type: string
                            nullable: true
                          principalName:
                            type: string
        
